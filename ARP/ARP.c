#include<stdio.h>

unsigned char i = 0x00;

void analizaLLC(unsigned char T[]){
    unsigned char SS[][5] = {"RR", "RNR", "REJ", "SREJ"};
    unsigned char UC[][6] = {"UI", "SIM", "-", "SARM", "UP", "-", "-", "SABM", "DISC", "-", "-", "SARME", "-", "-", "-", "SABME", "SNRM", "-", "-", "RSET", "-", "-", "-", "XID", "-", "-", "-", "SNRME"}; // comandos - p
    unsigned char UR[][6] = {"UI", "RIM", "-", "DM", "-", "-", "-", "-", "RD", "-", "-", "-", "UA", "-", "-", "-", "-", "FRMR", "-", "-", "-", "-", "-", "XID"}; // respuestas - f
    printf("\n\n..:::Cabecera LLC:::.."); //En LLC solo hay SABME T-U 1byte , T-S y T-I 2bytes
    switch(T[16] & 3){ 
        case 0:
        case 2: //T-I
         printf("\nT-I, N(s)=%d, N(r)=%d",T[16]>>1, T[17]>>1);
        if(T[17]&1){
            if(T[15]&1){ printf(", -f\n"); }//LSB SAPo
            else{ printf(", -p\n"); }
        }
        break;

        case 1: //T-S
        printf("\nT-S: %s, N(r)=%d", SS[(T[16]>>2) & 3], T[17]>>1);
        if(T[17]&1){ // p/f encendido?
            if(T[15]&1){ printf(", -f\n"); } //LSB SAPo
            else{ printf(", -p\n"); }
        }
        break;

        case 3: //T-U   
        if(T[16]&16){// p-f = 1?
            if(T[15]&1){ printf("\nT-U: %s -f\n", UR[((T[16] >> 2) & 3) | ((T[16] >> 3) & 28)] ); }//LSB SAPo
            else{ printf("\nT-U: %s -p\n", UC[((T[16] >> 2) & 3) | ((T[16] >> 3) & 28)] ); }
        }
        break;

    }
}

void analizaARP(unsigned char t[]){
	printf("\n\n..:::Cabecera ARP:::..");

	printf("\n\nTipo de direccion de HW: ");
	if(t[15] == 1){printf("Ethernet");}
	else if(t[15] == 6){printf("IEEE 802");}
	else if(t[15] == 15){printf("Frame Relay");}
	else if(t[15] == 16){printf("ATM");}
	else{printf("0x%.2x 0x%.2x", t[14], t[15]);}
	
	//Protocol Address Type
	printf("\nTipo de direccion de Protocolo:");
	if(t[16] == 8){
		printf(" IP");
	}else{
	printf(" 0x%.2x 0x%.2x", t[16], t[17]);
	}
	//HW Add Len
	printf("\nLongitud direccion HW: %d bytes", t[18]);

	//Protocol Add Len
	printf("\nLongitud direccion de Protocolo: %d bytes", t[19]);

	//OPCODE
	printf("\nCodigo de operacion: ");
	if(t[21] == 1){printf("ARP Request");}
	else if(t[21] == 2){printf("ARP Reply");}
	else if(t[21] == 3 || t[21] == 8){printf("Inverse ARP Request");}
	else if(t[21] == 9 || t[21] == 4){printf("Inverse ARP Reply");}
	else{printf("%d", (t[20] | t[21]));}
	
	//MAC Origen
	printf("\nMAC Origen: %.2x:%.2x:%.2x:%.2x:%.2x:%.2x", t[22], t[23], t[24], t[25], t[26], t[27]);

	//IP Origen
	printf("\nIP Origen: %d.%d.%d.%d", t[28], t[29], t[30], t[31]);

	//MAC Destino
	printf("\nMAC Destino: %.2x:%.2x:%.2x:%.2x:%.2x:%.2x", t[32], t[33], t[34], t[35], t[36], t[37]);

	//IP Destino
	printf("\nIP Destino: %d.%d.%d.%d\n", t[38], t[39], t[40], t[41]);

}

void analizaTrama(unsigned char t[]){
	    printf("\n-------------------------------------------------------------------------------------");
        printf("\n\n\tTrama: %d\n", i+1);
        printf("\n..:::Cabecera Ethernet:::..\n");
        printf("\nMAC Destino: %.2x:%.2x:%.2x:%.2x:%.2x:%.2x", t[0], t[1], t[2], t[3], t[4], t[5]);
        printf("\nMAC Origen: %.2x:%.2x:%.2x:%.2x:%.2x:%.2x", t[6], t[7], t[8], t[9], t[10], t[11]);
     
        unsigned short int tot = (t[12]<<8) | t[13]; // 2bytes

        if(tot<1500){
            printf("\nTama%co de cabecera LLC: %d bytes\n", 164, tot);
            analizaLLC(t);
        }
        else{
            if(tot == 2048){
                printf("\nTipo IP\n");
				
            }
            else if(tot == 2054){
                printf("\nTipo ARP\n");
				analizaARP(t);
            }
            else{
                printf("\nTipo: %.2x.%.2x\n", t[12], t[13]);
            }
        }

}

int main(){

    printf("\n\t<<<Escuela Superior de C%cmputo>>>\nElaborado por: Hern%cndez Rodr%cguez Armando Giovanni\n", 162, 160, 161);
    
    unsigned char t[][256]=
	{   // 16 columnas x fila
		{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x67,0xDF,0x8D,0xDF,0x74,0x3D,0x08,0x06,0x00,0x01, // TRAMA 1 ARP solicitud1
		 0x08,0x00,0x06,0x04,0x00,0x01,0x67,0xDF,0x8D,0xDF,0x74,0x3D,0xC3,0x00,0x00,0x01, 
		 0x00,0x00,0x00,0x00,0x00,0x00,0xC4,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		 {0x67,0xDF,0x8D,0xDF,0x74,0x3D,0x97,0xA9,0xA3,0x5F,0xA0,0xAE,0x08,0x06,0x00,0x01, // TRAMA 2 ARP respuesta1
		 0x08,0x00,0x06,0x04,0x00,0x02,0x97,0xA9,0xA3,0x5F,0xA0,0xAE,0xC3,0x00,0x00,0x02, 
		 0x67,0xDF,0x8D,0xDF,0x74,0x3D,0xC3,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		 {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x67,0xDF,0x8D,0xDF,0x74,0x3D,0x08,0x06,0x00,0x01, // TRAMA 3 ARP solicitud1
		 0x08,0x00,0x06,0x04,0x00,0x01,0x67,0xDF,0x8D,0xDF,0x74,0x3D,0xC3,0x00,0x00,0x01, 
		 0x00,0x00,0x00,0x00,0x00,0x00,0xC4,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		 {0x67,0xDF,0x8D,0xDF,0x74,0x3D,0x45,0x2C,0x7A,0x98,0x0B,0xD5,0x08,0x06,0x00,0x01, // TRAMA 4 ARP respuesta1
		 0x08,0x00,0x06,0x04,0x00,0x02,0x45,0x2C,0x7A,0x98,0x0B,0xD5,0xC3,0x00,0x00,0xFE, 
		 0x67,0xDF,0x8D,0xDF,0x74,0x3D,0xC3,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		 {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x46,0x72,0xCB,0xDE,0x46,0x7E,0x08,0x06,0x00,0x01, // TRAMA 5 ARP solicitud2
		 0x08,0x00,0x06,0x04,0x00,0x01,0x46,0x72,0xCB,0xDE,0x46,0x7E,0xC4,0x00,0x00,0xFE, 
		 0x00,0x00,0x00,0x00,0x00,0x00,0xC4,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		 {0x46,0x72,0xCB,0xDE,0x46,0x7E,0xF9,0x6A,0x51,0xE5,0x5B,0x81,0x08,0x06,0x00,0x01, // TRAMA 6 ARP respuesta2
		 0x08,0x00,0x06,0x04,0x00,0x02,0xF9,0x6A,0x51,0xE5,0x5B,0x81,0xC4,0x00,0x00,0x02, 
		 0x46,0x72,0xCB,0xDE,0x46,0x7E,0xC4,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
	};

	unsigned char t2[][256]=
	{   // 16 columnas x fila
		{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x08,0x06,0x00,0x01, // TRAMA 1 ARP solicitud1
		 0x08,0x00,0x06,0x04,0x00,0x01,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x01,0x00,0x00,0x01, 
		 0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		 {0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x1A,0x1A,0x1A,0x1A,0x1A,0x1A,0x08,0x06,0x00,0x01, // TRAMA 2 ARP respuesta1
		 0x08,0x00,0x06,0x04,0x00,0x02,0x1A,0x1A,0x1A,0x1A,0x1A,0x1A,0x01,0x00,0x00,0x02, 
		 0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		 {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x08,0x06,0x00,0x01, // TRAMA 3 ARP solicitud1
		 0x08,0x00,0x06,0x04,0x00,0x01,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x01,0x00,0x00,0x01, 
		 0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		 {0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x11,0x11,0x11,0x11,0x11,0x11,0x08,0x06,0x00,0x01, // TRAMA 4 ARP respuesta1
		 0x08,0x00,0x06,0x04,0x00,0x02,0x11,0x11,0x11,0x11,0x11,0x11,0x01,0x00,0x00,0x02, 
		 0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		 {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x22,0x22,0x22,0x22,0x22,0x22,0x08,0x06,0x00,0x01, // TRAMA 5 ARP solicitud2
		 0x08,0x00,0x06,0x04,0x00,0x01,0x22,0x22,0x22,0x22,0x22,0x22,0x02,0x00,0x00,0xFE, 
		 0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		 {0x22,0x22,0x22,0x22,0x22,0x22,0x1A,0x1A,0x1A,0x1A,0x1A,0x1A,0x08,0x06,0x00,0x01, // TRAMA 6 ARP respuesta2
		 0x08,0x00,0x06,0x04,0x00,0x02,0x1A,0x1A,0x1A,0x1A,0x1A,0x1A,0x02,0x00,0x00,0x01, 
		 0x22,0x22,0x22,0x22,0x22,0x22,0x02,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
	};
    
    
    for(i=0; i<6; i++){
		analizaTrama(t2[i]);
    }
    return 0;
}


